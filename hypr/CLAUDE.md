# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## What This Is

JaKooLit's Hyprland dotfiles configuration for Manjaro Linux with NVIDIA RTX 4060. This is a modular Hyprland rice with 40+ utility scripts, dynamic wallust-based theming, and a rofi-driven settings UI.

## Key Commands

```bash
# Reload Hyprland config after making changes
hyprctl reload

# Enable debug logging (temporarily) for troubleshooting
hyprctl keyword debug:disable_logs false

# Check for config errors after reload
grep -i "ERR\|WARN\|invalid\|unknown" /run/user/1000/hypr/*/hyprland.log | grep -v "aquamarine\|libinput\|libseat"

# Test a runtime config change without editing files
hyprctl keyword <section>:<option> <value>

# Check if a config option exists
hyprctl getoption <section>:<option>

# Inspect running windows (class, title, tags)
hyprctl clients

# Inspect layers (waybar, rofi, notifications)
hyprctl layers
```

## Config Sourcing Chain

`hyprland.conf` is the entry point. It sources everything in this order:

1. `configs/Keybinds.conf` - Default keybinds (system-managed, don't edit)
2. `UserConfigs/Startup_Apps.conf` - Startup daemons (swww, waybar, swaync, etc.)
3. `UserConfigs/ENVariables.conf` - Environment variables (GDK, Qt, XDG, NVIDIA, cursor)
4. `UserConfigs/Laptops.conf` - Laptop hardware keys and touchpad device
5. `UserConfigs/LaptopDisplay.conf` - Laptop lid switch behavior
6. `UserConfigs/WindowRules.conf` - Window/layer rules and app tagging
7. `UserConfigs/UserDecorations.conf` - Borders, gaps, blur, shadows, opacity
8. `UserConfigs/UserAnimations.conf` - Active animation preset (copied from `animations/`)
9. `UserConfigs/UserKeybinds.conf` - Custom user keybinds
10. `UserConfigs/UserSettings.conf` - Core settings (layouts, input, gestures, misc, cursor)
11. `UserConfigs/01-UserDefaults.conf` - Default apps ($term, $files, $EDITOR)
12. `monitors.conf` - Monitor setup (auto-generated by nwg-displays)
13. `workspaces.conf` - Workspace rules (auto-generated by nwg-displays)

`UserConfigs/UserDecorations.conf` also sources `wallust/wallust-hyprland.conf` for color variables (`$color0`-`$color15`, `$background`, `$foreground`).

## Architecture Principles

- **`configs/`** = system defaults (updated by upgrade scripts, don't customize here)
- **`UserConfigs/`** = user customization (protected from upgrades, edit these)
- **`UserScripts/`** = user-added scripts (protected from upgrades)
- **`scripts/`** = system utility scripts (40+ scripts for hardware, theming, UI)
- **`animations/`** = 36 preset animation configs; selected via `Animations.sh` which copies to `UserConfigs/UserAnimations.conf`

## Hyprland 0.53+ Syntax (CRITICAL)

This config uses **Hyprland 0.53.3** syntax. The window rule and layer rule formats changed completely from pre-0.53:

### Window Rules
```ini
# NEW syntax (0.53+) - always use this
windowrule = float on, match:class ^(kitty)$
windowrule = opacity 0.9 0.8, match:tag browser*
windowrule = float on, match:class ^([Ss]team)$ match:title negative:^([Ss]team)$
windowrule = tag +browser, match:class ^([Ff]irefox)$

# OLD syntax (pre-0.53) - DO NOT USE
# windowrule = float, class:^(kitty)$
# windowrule = opacity 0.9 0.8, tag:browser*
```

Key differences:
- Matchers: `class:` -> `match:class`, `title:` -> `match:title`, `tag:` -> `match:tag`, `initialTitle:` -> `match:initial_title`, `fullscreen:1` -> `match:fullscreen true`, `floating:1` -> `match:float true`
- Boolean actions need explicit `on`: `float` -> `float on`, `center` -> `center on`, `pin` -> `pin on`, `fullscreen` -> `fullscreen on`
- Renamed effects: `noblur` -> `no_blur on`, `keepaspectratio` -> `keep_aspect_ratio on`, `idleinhibit` -> `idle_inhibit`, `ignorezero` -> `ignore_alpha 0`
- Negation uses `negative:` prefix on the regex: `match:title negative:^(regex)$`
- Multi-match rules: space-separate matchers on one line: `match:class ^(foo)$ match:title ^(bar)$`

### Layer Rules
```ini
# NEW syntax (0.53+)
layerrule = blur on, match:namespace waybar
layerrule = ignore_alpha 0, match:namespace rofi

# OLD syntax - DO NOT USE
# layerrule = blur, waybar
# layerrule = ignorezero, rofi
```

### Gestures
```ini
# NEW syntax (0.51+)
gesture = 3, horizontal, workspace

# OLD syntax - DO NOT USE (removed in 0.51)
# gestures { workspace_swipe = true ... }
```

## Theming Pipeline

Wallpaper change triggers this chain:
1. `WallpaperSelect.sh` or `WallpaperAutoChange.sh` sets wallpaper via swww
2. `WallustSwww.sh` runs `wallust` to extract colors from the wallpaper
3. Wallust generates `wallust/wallust-hyprland.conf` with `$color0`-`$color15`
4. `Refresh.sh` reloads waybar, rofi, swaync, and ags to pick up new colors

Dark/light switching is handled by `DarkLight.sh` which toggles wallust palette between `dark16`/`light16` and updates waybar, swaync, ags, and kitty themes.

## NVIDIA-Specific Notes

This system runs NVIDIA RTX 4060 with driver 590.48. Key env vars in `ENVariables.conf`:
- `LIBVA_DRIVER_NAME=nvidia`
- `__GLX_VENDOR_LIBRARY_NAME=nvidia`
- `NVD_BACKEND=direct`

Hardware cursors are disabled (`no_hardware_cursors = 1` in `UserSettings.conf`).

## Variables Used Across Configs

Defined in `configs/Keybinds.conf` and `UserConfigs/UserKeybinds.conf`:
- `$mainMod = SUPER`
- `$scriptsDir = $HOME/.config/hypr/scripts`
- `$UserScripts = $HOME/.config/hypr/UserScripts`
- `$UserConfigs = $HOME/.config/hypr/UserConfigs`
- `$term = wezterm`, `$files = nautilus` (set in `01-UserDefaults.conf`)
